# 文件包含漏洞

**漏洞成因** \
和SQL注入等攻击方式一样，文件包含漏洞也是一种注入型漏洞，其本质就是输入一段用户能够控制的脚本或者代码，并让服务端执行。

什么叫包含呢？以PHP为例，我们常常把可重复使用的函数写入到单个文件中，在使用该函数时，直接调用此文件，而无需再次编写函数，这一过程叫做包含。

有时候由于网站功能需求，会让前端用户选择要包含的文件，而开发人员又没有对要包含的文件进行安全考虑，就导致攻击者可以通过修改文件的位置来让后台执行任意文件，从而导致文件包含漏洞。

以PHP为例,常用的文件包含函数有以下四种 include(),require(),include\_once(),require\_once()

区别如下:

**require():找不到被包含的文件会产生致命错误，并停止脚本运行** \
**include():找不到被包含的文件只会产生警告，脚本继续执行** \
**require\_once()与require()类似:唯一的区别是如果该文件的代码已经被包含，则不会再次包含** \
**include\_once()与include()类似:唯一的区别是如果该文件的代码已经被包含，则不会再次包含**

**攻击方式/类型** \
分为 **本地文件包含漏洞** 与 **远程文件包含漏洞** \
**本地文件包含**的话 可以利用绝对路径来获取账号信息 又或者读取服务器文件 在传参中加入若干个../与etc/passwd来看账号信息

如果PHP的配置选项`allow_url_include`、`allow_url_fopen`状态为ON的话，则**include/require**函数是可以加载远程文件的，这种漏洞被称为**远程文件包含** 这样的话可以下载远程网站的脚本 联合csrf攻击 或者执行远程代码

**如何防御** \
本地：**输入验证和过滤** 限制用户访问范围 使用白名单机制限制允许包含的文件或目录列表 只允许应用程序包含受信任的文件 \
远程：关闭`allow_url_include`、`allow_url_fopen`等配置
